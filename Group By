USE TEMPDB 
GO
CREATE TABLE tblPopulation
(
Country VARCHAR(100),
[State] VARCHAR(100),
City VARCHAR(100),
Population INT
)

INSERT tblPopulation VALUES			('COUNTRY1', 'STATE1','CITY1',9 ),
	('COUNTRY1', 'STATE1','CITY2',8 ), 	('COUNTRY1', 'STATE2','CITY1',5.5), 
	('COUNTRY1', 'STATE2','CITY2',7.5), 	('COUNTRY2', 'STATE1','CITY1',9.5), 
	('COUNTRY2', 'STATE1','CITY2',2.5),	('COUNTRY2', 'STATE2','CITY1',1.5),	
	('COUNTRY3', 'STATE1','CITY1',30),		('COUNTRY3', 'STATE1','CITY2',20)


-- QUERY 1: HOW TO REPORT LIST OF ALL POPULATION DETAILS?
SELECT * FROM tblPopulation

-- QUERY 2: HOW TO REPORT LIST OF ALL COUNTRY NAMES?
SELECT Country FROM tblPopulation

-- QUERY 3: HOW TO REPORT LIST OF ALL UNIQUE COUNTRIES DETAILS?
SELECT Country FROM tblPopulation
GROUP BY Country			-- GROUP BY IS USED TO REPORT UNIQUE VALUES AND ALSO PERFORM COMPUTATIONS.

-- RULE:  WHENEVER WE USE GROUP BY THEN COLUMNS USED IN SELECT SHOULD ALSO BE INCLUDED IN GROUP BY

-- QUERY 4: HOW TO REPORT TOTAL POPULATION?
SELECT SUM(POPULATION) FROM tblPopulation

-- QUERY 5: HOW TO REPORT TOTAL POPULATION FOR EACH COUNTRY?
SELECT Country, SUM(POPULATION) FROM tblPopulation
GROUP BY Country

-- QUERY 6: HOW TO REPORT TOTAL POPULATION FOR EACH COUNTRY?
SELECT Country, SUM(POPULATION) AS TOTAL_POPULATION FROM tblPopulation
GROUP BY Country

-- RULE FOR GROUP BY:  WHENEVER WE USE GROUP BY THEN COLUMNS USED IN SELECT SHOULD BE USED IN GROUP BY

-- QUERY 6: HOW TO REPORT COUNTRY WISE STATE WISE TOTAL POPULATION ?
SELECT Country, STATE, SUM(POPULATION) AS TOTAL_POPULATION FROM tblPopulation
GROUP BY Country			-- ERROR. REASON: STATE IS USED IN SELECT BUT NOT USED IN GROUP BY

SELECT Country, STATE, SUM(POPULATION) AS TOTAL_POPULATION FROM tblPopulation
GROUP BY Country, STATE

-- QUERY 7: HOW TO REPORT COUNTRY WISE STATE WISE TOTAL POPULATION ABOVE 15m?
SELECT Country, STATE, SUM(POPULATION) AS TOTAL_POPULATION FROM tblPopulation
GROUP BY Country, STATE
HAVING SUM(POPULATION) > 15

-- QUERY 8: HOW TO REPORT COUNTRY WISE TOTAL POPULATION?
SELECT Country, SUM(POPULATION) AS TOTAL_POPULATION FROM tblPopulation
GROUP BY Country


-- QUERY 9: HOW TO REPORT COUNTRY WISE TOTAL POPULATION AND GRAND TOTAL POPULATION?
SELECT Country, SUM(POPULATION) AS TOTAL_POPULATION FROM tblPopulation
GROUP BY ROLLUP(Country)

SELECT Country, SUM(POPULATION) AS TOTAL_POPULATION, GROUPING(Country) FROM tblPopulation
GROUP BY ROLLUP(Country)

-- QUERY 10: HOW TO REPORT COUNTRY WISE, STATE WISE TOTAL POPULATION WITH SUB TOTALS, GRAND TOTAL?
SELECT Country, STATE, SUM(POPULATION) AS TOTAL_POPULATION FROM tblPopulation
GROUP BY ROLLUP(Country, STATE)		-- REPORTS SUB TOTALS FOR ALL COLUMNS EXCEPT LAST COLUMN IN GROUP BY

-- QUERY 11: HOW TO REPORT COUNTRY WISE, STATE WISE TOTAL POPULATION WITH SUB TOTALS, GRAND TOTAL?
SELECT Country, STATE, SUM(POPULATION) AS TOTAL_POPULATION FROM tblPopulation
GROUP BY CUBE(Country, STATE)		-- REPORTS SUB TOTALS FOR ALL COLUMNS INCLUDING LAST COLUMN IN GROUP BY

-- QUERY 12: HOW TO IDENTIFY THE NEW ROWS RESULTING FROM CUBE AND ROLLUP?
SELECT Country, STATE, SUM(POPULATION) AS TOTAL_POPULATION, GROUPING(STATE) AS ROW_STATUS
FROM tblPopulation
GROUP BY ROLLUP(Country, STATE)	

-- QUERY 13: HOW TO IDENTIFY ONLY THE SUB TOTALS AND GRAND TOTALS?
SELECT Country, STATE, SUM(POPULATION) AS TOTAL_POPULATION, GROUPING(STATE) AS ROW_STATUS
FROM tblPopulation
GROUP BY ROLLUP(Country, STATE)	
HAVING GROUPING(STATE) = 1

-- QUERY 14: HOW TO IDENTIFY THE ACTUAL SOURCE DATA WITHOUT THE SUB TOTALS AND GRAND TOTALS?
SELECT Country, STATE, SUM(POPULATION) AS TOTAL_POPULATION, GROUPING(STATE) AS ROW_STATUS
FROM tblPopulation
GROUP BY ROLLUP(Country, STATE)	
HAVING GROUPING(STATE) = 0

-- HOW TO COMBINE ABOVE TWO RESULTS?
SELECT Country, STATE, SUM(POPULATION) AS TOTAL_POPULATION, GROUPING(STATE) AS ROW_STATUS
FROM tblPopulation
GROUP BY ROLLUP(Country, STATE)	
HAVING GROUPING(STATE) = 0
UNION ALL
SELECT Country, STATE, SUM(POPULATION) AS TOTAL_POPULATION, GROUPING(STATE) AS ROW_STATUS
FROM tblPopulation
GROUP BY ROLLUP(Country, STATE)	
HAVING GROUPING(STATE) = 1

SELECT Country, STATE, SUM(POPULATION) AS TOTAL_POPULATION, GROUPING(STATE) AS ROW_STATUS
FROM tblPopulation
GROUP BY Country, STATE				-- 5 ROWS

SELECT Country, STATE, SUM(POPULATION) AS TOTAL_POPULATION, GROUPING(STATE) AS ROW_STATUS
FROM tblPopulation
GROUP BY ROLLUP(Country, STATE)		-- 9 ROWS				COUNTRY WISE TOTALS  + GRAND TOTAL

SELECT Country, STATE, SUM(POPULATION) AS TOTAL_POPULATION, GROUPING(STATE) AS ROW_STATUS
FROM tblPopulation
GROUP BY CUBE(Country, STATE)		-- 11 ROWS		COUNTRY WISE TOTALS  + GRAND TOTAL + STATE WISE TOTAL	
